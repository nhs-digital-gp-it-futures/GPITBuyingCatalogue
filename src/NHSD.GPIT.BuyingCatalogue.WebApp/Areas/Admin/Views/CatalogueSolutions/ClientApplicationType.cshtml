@using NHSD.GPIT.BuyingCatalogue.ServiceContracts.Solutions;
@using NHSD.GPIT.BuyingCatalogue.WebApp.Areas.Admin.Controllers
@using NHSD.GPIT.BuyingCatalogue.Framework.Extensions
@using EnumsNET
@model NHSD.GPIT.BuyingCatalogue.WebApp.Areas.Admin.Models.ClientApplicationTypeSectionModel;
@{
    ViewBag.Title = "Client application type";
}
<div class="nhsuk-width-container">
    <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
            <partial name="Partials/_BackLink" model="Model" />
        </div>
        <div class="nhsuk-grid-column-two-thirds">
            <nhs-validation-summary />
            <nhs-page-title title="@ViewBag.Title"
                            caption="@Model.SolutionName"
                            advice="Let buyers know which types of application will work with your Catalogue Solution." />

            @*TODO: Update Action Link to Add Client application type*@
            <vc:nhs-action-link url="@Url.Action(
            nameof(CatalogueSolutionsController.AddApplicationType),
            typeof(CatalogueSolutionsController).ControllerName(),
            new { Model.SolutionId })" text=" Add an application type" />

            <p>
                Use the link to add information on each of the application types your Catalogue Solution works with.
            </p>

            <form method="post">
                <input type="hidden" asp-for="@Model.SolutionId" />
                <input type="hidden" asp-for="@Model.BackLink" />
                <input type="hidden" asp-for="@Model.ExistingApplicationTypesCount" />

                @if (Model.ExistingClientApplicationTypes.Any())
                {
                    <nhs-table>
                        <nhs-table-column>Application types added</nhs-table-column>
                        <nhs-table-column> </nhs-table-column>

                        @foreach (var applicationType in Model.ExistingClientApplicationTypes)
                        {
                            <nhs-table-row-container>
                                <nhs-table-cell>@FormatApplicationType(applicationType)</nhs-table-cell>
                                <nhs-table-cell>
                                    @if (applicationType == ClientApplicationType.MobileTablet)
                                    {
                                        <a asp-action="@applicationType" asp-controller="MobileTabletBased" asp-route-solutionId="@Model.SolutionId" class="nhsuk-breadcrumb__link">Edit</a>
                                    }
                                    else if (applicationType == ClientApplicationType.Desktop)
                                    {
                                        <a asp-action="@applicationType" asp-controller="DesktopBased" asp-route-solutionId="@Model.SolutionId" class="nhsuk-breadcrumb__link">Edit</a>
                                    }
                                    else
                                    {
                                        <a asp-action="@applicationType" asp-controller="CatalogueSolutions" asp-route-solutionId="@Model.SolutionId" class="nhsuk-breadcrumb__link">Edit</a>
                                    }

                                </nhs-table-cell>
                            </nhs-table-row-container>
                        }
                    </nhs-table>
                }
                
                <vc:nhs-secondary-button text="Continue"
                                         use-primary-colour="true"
                                         url="@Url.Action(
                                     nameof(CatalogueSolutionsController.ManageCatalogueSolution),
                                     typeof(CatalogueSolutionsController).ControllerName(),
                                     new { Model.SolutionId })" />

            </form>
        </div>
    </div>
</div>

@{ 
    string FormatApplicationType(ClientApplicationType applicationType) => applicationType switch
    {
        ClientApplicationType.MobileTablet => "Mobile application",
        _ => $"{applicationType.AsString(EnumFormat.DisplayName)} application",
    };
}
