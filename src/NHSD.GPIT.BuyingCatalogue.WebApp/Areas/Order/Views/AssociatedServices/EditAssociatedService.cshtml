@using NHSD.GPIT.BuyingCatalogue.EntityFramework.Catalogue.Models
@using NHSD.GPIT.BuyingCatalogue.Framework.Extensions
@using NHSD.GPIT.BuyingCatalogue.WebApp.Areas.Order.Controllers
@model NHSD.GPIT.BuyingCatalogue.WebApp.Areas.Order.Models.AssociatedServices.EditAssociatedServiceModel;
@{
    ViewBag.Title = Model.Title;

    var pricingUnit = string.Concat(Model.OrderItem.CataloguePrice.PricingUnit.Description, Model.OrderItem.TimeUnitDescription).Trim();
}

<div data-test-id="order-item-page">
    <partial name="Partials/_BackLink" model="Model" />
    <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-two-thirds">
            <nhs-validation-summary RadioId="EstimationPeriod" />
            <nhs-page-title title="@ViewBag.Title"
                            advice="Provide the price you've agreed with the supplier and the quantity you want to order." />

            <form method="post">
                <input type="hidden" asp-for="BackLink" />
                <input type="hidden" asp-for="BackLinkText" />
                <input type="hidden" asp-for="InternalOrgId" />
                <input type="hidden" asp-for="Title" />
                <input type="hidden" asp-for="OrderItem.ServiceRecipients[0].Name" />
                <input type="hidden" asp-for="OrderItem.CataloguePrice.ProvisioningType" />
                <input type="hidden" asp-for="OrderItem.CataloguePrice.Price" />
                <input type="hidden" asp-for="OrderItem.CommencementDate" />

                <input type="hidden" asp-for="OrderItem.ServiceRecipients[0].OdsCode" />
                <nhs-bookended-input asp-for="OrderItem.ServiceRecipients[0].Quantity"
                                     label-text="How many do you think you'll need?" />
                <nhs-details label-text="What quantity should I enter?">
                    Enter the estimated quantity you think you'll need either per month or per year.
                </nhs-details>
                <br />
                @if (Model.OrderItem.CataloguePrice.ProvisioningType == ProvisioningType.OnDemand)
                {
                    <div id="selectEstimationPeriod" data-test-id="question-selectEstimationPeriod">
                        <div data-test-id="radiobutton-options">
                            <nhs-fieldset-form-label asp-for="@Model"
                                                     label-text="Over what period did you estimate the quantity?"
                                                     label-hint="Select one option."
                                                     size="Medium">
                                <nhs-radio-buttons asp-for="EstimationPeriod"
                                                   values="@Model.TimeUnits.Cast<object>()"
                                                   value-name="EnumMemberName"
                                                   display-name="Description" />
                            </nhs-fieldset-form-label>
                        </div>
                    </div>
                    <div data-test-id="view-section-estimation-period-id" class="">
                        <nhs-details label-text="What period should I enter?">
                            This should be based on how you estimated the quantity you want to order.
                        </nhs-details>
                    </div>
                }
                <br />
                <nhs-bookended-input asp-for="OrderItem.AgreedPrice"
                                     label-text="What price have you agreed, in pounds, @pricingUnit?"
                                     label-hint="You can change the list price if you've agreed a different rate with the supplier."
                                     Prefix="@Model.OrderItem.CurrencySymbol"
                                     Suffix="@pricingUnit" />
                <nhs-details label-text="What price should I enter?">
                    You can change the list price if you’ve agreed a different rate with the supplier.
                </nhs-details>
                <br />
                <nhs-submit-button />
                <br />
                <vc:nhs-delete-button text="Delete Associated Service"
                                      url="@Url.Action(
                                               nameof(DeleteAssociatedServiceController.DeleteAssociatedService),
                                               typeof(DeleteAssociatedServiceController).ControllerName(),
                                          new { Model.InternalOrgId,
                                                Model.OrderItem.CallOffId,
                                                Model.OrderItem.CatalogueItemId,
                                                Model.OrderItem.CatalogueItemName})" />

            </form>
        </div>
    </div>
</div>
