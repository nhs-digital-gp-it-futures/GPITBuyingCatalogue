const filterUrl="/filter",queryCapabilities="capabilities",querySelectedFramework="selectedframework",filterContainer="filter-container",filterCapabilitiesDetails="filter-capabilities-details",filterDetailsText=".nhsuk-details__text",EpicSplitCharacter="E",DFOCVCMarker="D",SupplierSplitCharacter="S",SupplierSolutionCharacter="X",CapabilityMarker="C",InputTypeHidden="input[type='hidden']",NhsukCheckboxesInput=".nhsuk-checkboxes__input",NhsukCheckboxesItem=".nhsuk-checkboxes__item",NhsRadiosInput=".nhsuk-radios__input",CapabilitiesDelimiter="|";function ReplaceFilterAndAddBinders(e){const t=document.getElementById(filterContainer),n=document.getElementById("filter-form");n.parentNode.removeChild(n),t.innerHTML=e;const i=document.getElementById("Submit");i.removeAttribute("type"),i.addEventListener("click",generateQueryParam),document.querySelectorAll(NhsRadiosInput).forEach((e=>{e.addEventListener("click",reload)})),RefireDomContentLoadedEvent(),reselectCapabilityAndEpicsFiltersAndFrameworkFilter()}function generateQueryParam(){let e="";document.querySelectorAll("#filter-container .nhsuk-checkboxes__input").forEach((t=>{if(t.checked){const n=t.parentNode.querySelector(InputTypeHidden).getAttribute("value");n.includes("S")?e+=EncodeSupplierDefinedEpic(n):n.includes("E")&&!n.includes("C")?e+=EncodeDFOCVCEpic(n):n.includes("E")&&n.includes("C")?e+=EncodeNormalEpic(n):e.length>1?e+="|"+n:e+=n}}));const t=new URL(window.location.href);t.searchParams.delete("page"),t.searchParams.delete("capabilities"),t.searchParams.delete("selectedframework"),e.length>0&&t.searchParams.append("capabilities",e),t.searchParams.append("selectedframework",GetSelectedFramework()),window.location.href=t.toString()}function reload(){const e=GetSelectedFramework(),t=new URL(window.location.href);t.pathname+="/filter",t.searchParams.delete("selectedframework"),t.searchParams.append("selectedframework",e);const n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?refreshCapabilitiesAndEpics(n.responseText):console.log("Error: "+n.status))},n.open("GET",t.toString(),!0),n.send()}function refreshCapabilitiesAndEpics(e){const t=(new DOMParser).parseFromString(e,"text/html").getElementById(filterCapabilitiesDetails).querySelector(filterDetailsText),n=document.getElementById(filterCapabilitiesDetails).querySelector(filterDetailsText);n.parentNode.removeChild(n),document.getElementById(filterCapabilitiesDetails).appendChild(t),RefireDomContentLoadedEvent()}function reselectCapabilityAndEpicsFiltersAndFrameworkFilter(){const e=new URLSearchParams(window.location.search),t=e.get("capabilities"),n=e.get("selectedframework");if(t&&t.length>0){t.split("|").forEach((e=>{if("FC"!==e&&e.includes("E")){const t=e.split("S").map((e=>e.split("E"))).flat();t.forEach((e=>{e.startsWith("C")?CheckCheckboxWithHiddenInputValue(e):e.includes("D")?CheckCheckboxWithHiddenInputValue(DecodeDFOCVCEpic(e)):e.includes("X")?CheckCheckboxWithHiddenInputValue(DecodeSupplierDefinedEpic(e)):CheckCheckboxWithHiddenInputValue(DecodeNormalEpic(t[0],e))}))}else CheckCheckboxWithHiddenInputValue(e)}))}if(n&&n.length>0){const e=NhsRadiosInput+"[value='"+n+"']";document.querySelector(e).checked=!0}}function CheckCheckboxWithHiddenInputValue(e){const t="#filter-container .nhsuk-checkboxes__item "+InputTypeHidden+"[value='"+e+"']";document.querySelector(t).parentNode.querySelector(NhsukCheckboxesInput).click()}function GetSelectedFramework(){const e=document.querySelectorAll(NhsRadiosInput);let t="All";for(let n=0;n<e.length;n++)if(e[n].checked){t=e[n].value;break}return t}function RefireDomContentLoadedEvent(){window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0}))}function EncodeNormalEpic(e){return e.substring(e.indexOf("E"))}function EncodeDFOCVCEpic(e){return"E"+e.substring(4)+"D"}function EncodeSupplierDefinedEpic(e){return e.replace("E0","_").replace("S0","S").replace("X0","X")}function DecodeNormalEpic(e,t){return e+"E"+t}function DecodeDFOCVCEpic(e){return"E000"+e.substring(0,2)}function DecodeSupplierDefinedEpic(e){return("S0"+e).replace("_","E0").replace("X","X0")}window.onload=function(){const e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(200===e.status?ReplaceFilterAndAddBinders(e.responseText):console.log("Error: "+e.status))};const t=new URL(window.location.href);t.pathname+="/filter";const n=new URLSearchParams(window.location.search).get("selectedframework");n&&n.length>0&&t.searchParams.append("selectedframework",n),e.open("GET",t.toString(),!0),e.send()};