const filterUrl="/filter",queryCapabilities="capabilities",querySelectedFramework="selectedframework",filterContainer="filter-container",filterCapabilitiesDetails="filter-capabilities-details",filterDetailsText=".nhsuk-details__text",EpicSplitCharacter="E",DFOCVCMarker="D",SupplierSplitCharacter="S",SupplierSolutionCharacter="X",CapabilityMarker="C",InputTypeHidden="input[type='hidden']",NhsukCheckboxesInput=".nhsuk-checkboxes__input",NhsukCheckboxesItem=".nhsuk-checkboxes__item",NhsRadiosInput=".nhsuk-radios__input",CapabilitiesDelimiter="|";class CatalogueSolutionsFilter{constructor(){this.ReplaceFilterAndAddBinders=e=>{const t=document.getElementById(filterContainer),i=document.getElementById("filter-form");i.parentNode.removeChild(i),t.innerHTML=e;const r=document.getElementById("Submit");r.removeAttribute("type"),r.addEventListener("click",this.generateQueryParam),document.querySelectorAll(NhsRadiosInput).forEach((e=>{e.addEventListener("click",this.reload)})),this.RefireDomContentLoadedEvent(),this.reselectCapabilityAndEpicsFiltersAndFrameworkFilter()},this.generateQueryParam=()=>{let e="";document.querySelectorAll("#filter-container .nhsuk-checkboxes__input").forEach((t=>{if(t.checked){let i=null;i=t.parentNode.querySelector(InputTypeHidden).getAttribute("value"),i.includes("S")?e+=this.EncodeSupplierDefinedEpic(i):i.includes("E")&&!i.includes("C")?e+=this.EncodeDFOCVCEpic(i):i.includes("E")&&i.includes("C")?e+=this.EncodeNormalEpic(i):e.length>1?e+="|"+i:e+=i}}));const t=new URL(window.location.href);t.searchParams.delete("page"),t.searchParams.delete("capabilities"),t.searchParams.delete("selectedframework"),e.length>0&&t.searchParams.append("capabilities",e),t.searchParams.append("selectedframework",this.GetSelectedFramework()),window.location.href=t.toString()},this.reload=()=>{const e=this.GetSelectedFramework(),t=new URL(window.location.href);t.pathname+="/filter",t.searchParams.delete("selectedframework"),t.searchParams.append("selectedframework",e);const i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?refreshCapabilitiesAndEpics(i.responseText):console.log("Error: "+i.status))}},this.reselectCapabilityAndEpicsFiltersAndFrameworkFilter=()=>{const e=new URLSearchParams(window.location.search),t=e.get("capabilities"),i=e.get("selectedframework");if(t&&t.length>0){t.split("|").forEach((e=>{if("FC"!==e&&e.includes("E")){const t=e.split("S").map((e=>e.split("E"))).concat.apply([]);t.forEach((e=>{e.startsWith("C")?this.CheckCheckboxWithHiddenInputValue(e):e.includes("D")?this.CheckCheckboxWithHiddenInputValue(this.DecodeDFOCVCEpic(e)):e.includes("X")?this.CheckCheckboxWithHiddenInputValue(this.DecodeSupplierDefinedEpic(e)):this.CheckCheckboxWithHiddenInputValue(this.DecodeNormalEpic(t[0],e))}))}else this.CheckCheckboxWithHiddenInputValue(e)}))}if(i&&i.length>0){const e=NhsRadiosInput+"[value='"+i+"']";document.querySelector(e).checked=!0}}}CheckCheckboxWithHiddenInputValue(e){const t="#filter-container .nhsuk-checkboxes__item "+InputTypeHidden+"[value='"+e+"']";document.querySelector(t).parentNode.querySelector(NhsukCheckboxesInput).click()}GetSelectedFramework(){const e=document.querySelectorAll(NhsRadiosInput);let t="All";for(let i=0;i<e.length;i++){const r=e[i];if(r.checked){t=r.value;break}}return t}RefireDomContentLoadedEvent(){window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0}))}EncodeNormalEpic(e){return e.substring(e.indexOf("E"))}EncodeDFOCVCEpic(e){return"E"+e.substring(4)+"D"}EncodeSupplierDefinedEpic(e){return e.replace("E0","_").replace("S0","S").replace("X0","X")}DecodeNormalEpic(e,t){return e+"E"+t}DecodeDFOCVCEpic(e){return"E000"+e.substring(0,2)}DecodeSupplierDefinedEpic(e){return("S0"+e).replace("_","E0").replace("X","X0")}}function refreshCapabilitiesAndEpics(e){let t=null;t=(new DOMParser).parseFromString(e,"text/html").getElementById(filterCapabilitiesDetails).querySelector(filterDetailsText);let i=null;i=document.getElementById(filterCapabilitiesDetails).querySelector(filterDetailsText),i.parentNode.removeChild(i),document.getElementById(filterCapabilitiesDetails).appendChild(t),this.RefireDomContentLoadedEvent()}window.onload=function(){var e=new CatalogueSolutionsFilter;const t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e.ReplaceFilterAndAddBinders(t.responseText):console.log("Error: "+t.status))};const i=new URL(window.location.href);i.pathname+="/filter";const r=new URLSearchParams(window.location.search).get("selectedframework");r&&r.length>0&&i.searchParams.append("selectedframework",r),t.open("GET",i.toString(),!0),t.send()};