@using NHSD.GPIT.BuyingCatalogue.WebApp.Controllers
@using NHSD.GPIT.BuyingCatalogue.Framework.Extensions
@using NHSD.GPIT.BuyingCatalogue.WebApp.Areas.Solutions.Controllers
@using NHSD.GPIT.BuyingCatalogue.WebApp.Models.Shared;
@model SelectCapabilitiesModel
@{
    ViewBag.Title = Model.Title;
    var index = 0;
}

<script type="text/javascript" src="@Url.Content("~/js/GroupCounters.min.js")" asp-append-version="true"></script>

<partial name="Partials/_BackLink" model="Model" />
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
        <nhs-validation-summary RadioId="IsActive" />
        <nhs-page-title title="@ViewBag.Title"
                        advice="@Model.Advice" />

        <form method="post">
            @foreach (var category in Model.Groups)
            {
                var capabilities = Model.Items(category.Id);
                <nhs-expander heading-text="@category.Name"
                          label-text="@capabilities.Count @(capabilities.Count == 1 ? "result" : "results")"
                          open="true">
                    <nhs-table label-text="Capability name">
                        @foreach (var capability in capabilities)
                        {
                            <nhs-table-row-container>
                                <nhs-table-cell>
                                    <nhs-checkbox-container>
                                        <nhs-checkbox asp-for="SelectedItems[index].Selected"
                                              hidden-input="SelectedItems[index].Id"
                                              label-text="@capability.Name"
                                              sub-group="@category.Name" />
                                    </nhs-checkbox-container>
                                </nhs-table-cell>
                            </nhs-table-row-container>
                            index++;
                        }
                    </nhs-table>
                </nhs-expander>
                <br />
            }

            <p class="selection-counter" style="display: none">
                0 out of @Model.Total selected
            </p>

            <nhs-submit-button />
        </form>
    </div>
</div>
